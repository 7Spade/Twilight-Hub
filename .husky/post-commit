#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# 檢查是否為自動文檔更新提交，避免無限循環
if git log -1 --pretty=%B | grep -q "docs: auto-update project structure and TODO reports"; then
    echo "[post-commit] Skipping auto-update (already an auto-update commit)"
    exit 0
fi

echo "[post-commit] Updating documentation..."

# 更新項目結構文檔
echo "[post-commit] Updating project structure..."
npx --yes tsx scripts/generate-tree.ts

# 更新 TODO 報告
echo "[post-commit] Scanning TODOs..."
npx --yes tsx scripts/todo-automation-toolkit.ts

# 檢查並提交文檔更新
if ! git diff --quiet docs/project-structure.md .todo-reports/; then
    echo "[post-commit] Documentation updated, committing changes..."
    git add docs/project-structure.md .todo-reports/
    git commit -m "docs: auto-update project structure and TODO reports [skip ci]"
    echo "[post-commit] Documentation commit created"
else
    echo "[post-commit] No documentation changes detected"
fi
